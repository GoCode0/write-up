#!/usr/bin/env sage
p = 7389313481223384214994762619823300589978423075857540712007981373887018860174846208000957230283669342186460652521580595183523706412588695116906905718440770776239313669678685198683933547601793742596023475603667
e = 31337
f = 7236042467316654159796543399639966340258093274047941788600980451877044636122969830708918356119442228154447395855689559447196348683125675305629837437591088260218138895919514078948650757100432223219969122629790
g = 1878626136321051642174045874618248475160620873585704351202865003185878331837410979441756843820270907300810543618813757245154196050399357659526631164136221434463496532263979506870318259276669412698827040743576

c = 871346503375040565701864845493751233877009611275883500035764036792906970084258238763963152627486758242101207127598485219754255161617890137664012548226251138485059295263306930653899766537171223837761341914356

crt_a = []
crt_m = []

FACTOR = [
    (2, 1),
    (136327, 1),
    (164341, 1),
    (169937, 4),
    (313351, 4),
    (321427, 4),
    (323377, 4),
    (356887, 4),
    (413783, 1),
    (519733, 3),
    (792413, 4),
    (860077, 4),
    (906289, 1),
    (976501, 2),
]


for q, deg in FACTOR:
    print(" ====== now ", q, deg, "======")
    base = 0
    # if q != 164341: continue
    for d in range(0, deg):
        MOD = q ^ (d + 1)
        e_exp = 1
        f_exp = 1
        g_exp = 1
        xx = 1
        if d >= 1:
            xx = q ^ (d - 1) * (q - 1)

        e_multiple = pow(e, xx, MOD)
        f_multiple = pow(f, xx, MOD)
        g_multiple = pow(g, xx, MOD)

        for i in range(1, q):
            e_exp = e_exp * e_multiple % MOD
            f_exp = f_exp * f_multiple % MOD
            g_exp = g_exp * g_multiple % MOD
            c_rem = c % MOD
            a = (110 * e_exp + 313 * f_exp + 114 * g_exp) % MOD
            if a == c_rem:
                print(q, d, i)
                base = base * q + i
                break
        else:
            print("smth wrong..")
            break

    crt_a.append(base)
    crt_m.append(q ^ deg)

print(crt(crt_a, crt_m))
print(hex(crt(crt_a, crt_m)))
